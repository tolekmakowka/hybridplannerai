.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.back{display:inline-flex;gap:8px;align-items:center;border:1px solid var(--border);padding:8px 12px;border-radius:10px}
.lang-toggle{background:#111;color:#fff;border:1px solid #333;padding:6px 10px;border-radius:10px;font:600 12px/1 Inter;text-decoration:none}

/* Drawer button right + drawer itself */
.menu-toggle{
  background:#111;color:#fff;border:1px solid #333;width:42px;height:38px;border-radius:10px;
  display:grid;place-items:center;cursor:pointer
}
.menu-toggle span{display:block;width:18px;height:2px;background:#fff;position:relative}
.menu-toggle span::before,.menu-toggle span::after{content:"";position:absolute;left:0;width:18px;height:2px;background:#fff}
.menu-toggle span::before{top:-6px}.menu-toggle span::after{top:6px}
.header-right{display:flex;gap:10px;align-items:center}

.drawer{position:fixed;inset:0;z-index:10000;display:none}
.drawer.open{display:block}
.drawer .backdrop{position:absolute;inset:0;background:rgba(0,0,0,.55)}
.drawer .panel{
  position:absolute;top:0;right:0;height:100%;width:min(86vw,360px);
  background:#fff;color:#111;box-shadow:-20px 0 40px rgba(0,0,0,.35);display:flex;flex-direction:column
}
.drawer header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #eee}
.drawer header h4{margin:0;font:700 16px/1 Poppins;color:#111}
.drawer header button{background:#111;color:#fff;border:1px solid #333;border-radius:999px;width:34px;height:34px;cursor:pointer}
.drawer nav a{display:block;padding:18px 16px;border-bottom:1px solid #eee;font:700 16px/1.2 Poppins;color:#111}

.card{background:#141414;border:1px solid var(--border);border-radius:16px;padding:18px;box-shadow:var(--shadow)}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.row{display:grid;gap:8px;margin:10px 0}
@@ -71,36 +48,15 @@
<div class="container">
<div class="header">
<a class="back" href="index.html" id="backLbl">← Wróć</a>
    <div class="header-right">
      <a id="langToggle" class="lang-toggle" href="?lang=en" aria-label="English version">EN</a>
      <button id="menuBtn" class="menu-toggle" aria-label="Menu"><span></span></button>
    </div>
    <a id="langToggle" class="lang-toggle" href="?lang=en" aria-label="English version">EN</a>
</div>

  <!-- Drawer -->
  <aside id="drawer" class="drawer" aria-hidden="true">
    <div class="backdrop" id="drawerBackdrop"></div>
    <div class="panel" role="dialog" aria-modal="true">
      <header>
        <h4 id="drawerTitle">Menu</h4>
        <button id="menuClose" aria-label="Zamknij">✕</button>
      </header>
      <nav>
        <a id="menuPlan" href="generator.html">Plan treningowy</a>
        <a id="menuDetails" href="index.html#features">Szczegóły tworzenia planu treningowego</a>
        <a id="menuAbout" href="index.html#about">O mnie</a>
        <a id="menuContact" href="mailto:hello@hybridplanner.app">Kontakt</a>
      </nav>
    </div>
  </aside>

<div class="card">
<h1 id="title">Generator planów</h1>
<p id="subtitle" style="margin:6px 0 14px;color:#C9C7C2">
Wybierz odpowiedzi i <strong>opłać zamówienie</strong>. Po płatności plan (Excel) zostanie wysłany na Twój e-mail.
</p>

    <!-- tylko Plan A -->
<h2 id="hA">Plan — pytania (5)</h2>
<div class="grid-2">
<div class="row">
@@ -149,24 +105,15 @@ <h2 id="hA">Plan — pytania (5)</h2>
</div>

<script>
/* ---------- Endpoints funkcji Netlify ---------- */
/* ---------- Endpoints ---------- */
const HP = {
generate: '/.netlify/functions/generate-plan',
sendEmail: '/.netlify/functions/send-email',
  checkout:  '/.netlify/functions/create-checkout'
  // główna ścieżka + fallback (dla zgodności z różnymi nazwami funkcji)
  checkoutPrimary:  '/.netlify/functions/create-checkout-session',
  checkoutFallback: '/.netlify/functions/create-checkout'
};

/* ---------- Drawer ---------- */
const drawer = document.getElementById('drawer');
const menuBtn = document.getElementById('menuBtn');
const menuClose = document.getElementById('menuClose');
const drawerBackdrop = document.getElementById('drawerBackdrop');
function openDrawer(){ drawer.classList.add('open'); document.body.style.overflow='hidden'; }
function closeDrawer(){ drawer.classList.remove('open'); document.body.style.overflow=''; }
menuBtn.addEventListener('click', openDrawer);
menuClose.addEventListener('click', closeDrawer);
drawerBackdrop.addEventListener('click', closeDrawer);

/* ---------- Bramka e-mail ---------- */
(function(){
const mail = localStorage.getItem('hp_email');
@@ -175,7 +122,7 @@ <h2 id="hA">Plan — pytania (5)</h2>
else { document.getElementById('who').textContent = mail; }
})();

/* ===================== payload ===================== */
/* ---------- payload ---------- */
function buildPayload(){
return {
type: 'A',
@@ -190,7 +137,7 @@ <h2 id="hA">Plan — pytania (5)</h2>
};
}

/* ===================== generate-plan ===================== */
/* ---------- generate-plan ---------- */
async function callBackendForXlsx(payload){
const res = await fetch(HP.generate, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
const text = await res.text();
@@ -203,7 +150,7 @@ <h2 id="hA">Plan — pytania (5)</h2>
return { xlsxBase64: base64, xlsxFilename: filename };
}

/* ===================== e-mail ===================== */
/* ---------- e-mail ---------- */
async function sendPlanByEmail(base64, filename){
const to = localStorage.getItem('hp_email') || '';
if(!to) return;
@@ -221,17 +168,33 @@ <h2 id="hA">Plan — pytania (5)</h2>
if(!resp.ok){ console.warn('send-email error:', await resp.text()); }
}

/* ===================== Stripe Checkout ===================== */
/* ---------- Stripe Checkout ---------- */
async function tryCreateCheckout(endpoint, payload){
  const r = await fetch(endpoint, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(payload)
  });
  const txt = await r.text();
  let data = null; try { data = JSON.parse(txt) } catch {}
  if(!r.ok || !data?.url) throw new Error((data && (data.error||data.details)) || txt || 'checkout failed');
  return data.url;
}

async function createCheckout(){
const email = localStorage.getItem('hp_email') || '';
  const url = new URL(window.location.href);
  url.searchParams.set('checkout','success');
  const successUrl = url.toString();
  const cancelUrl = window.location.origin + window.location.pathname + '?checkout=cancel';
  const r = await fetch(HP.checkout, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, successUrl, cancelUrl }) });
  const data = await r.json().catch(()=>null);
  if(!r.ok || !data?.url) throw new Error((data && (data.error||data.details)) || 'checkout failed');
  return data.url;

  // urls muszą być HTTPS i kompletne
  const base = window.location.origin + window.location.pathname;
  const successUrl = base + '?checkout=success';
  const cancelUrl  = base + '?checkout=cancel';

  const payload = { email, successUrl, cancelUrl };

  // 1) spróbuj nazwę standardową
  try { return await tryCreateCheckout(HP.checkoutPrimary, payload); }
  // 2) fallback na starą nazwę
  catch { return await tryCreateCheckout(HP.checkoutFallback, payload); }
}

/* ---------- UI ---------- */
@@ -247,7 +210,7 @@ <h2 id="hA">Plan — pytania (5)</h2>
sessionStorage.setItem('hp_pending_payload', JSON.stringify(payload));

const checkoutUrl = await createCheckout();
    window.location.href = checkoutUrl;
    window.location.href = checkoutUrl; // -> Stripe
}catch(e){
console.error(e);
alert('Nie udało się rozpocząć płatności: ' + String(e.message || e));
@@ -288,54 +251,5 @@ <h2 id="hA">Plan — pytania (5)</h2>
}
})();
</script>

<!-- i18n (menu + istniejące) -->
<script>
(function(){
  const params = new URLSearchParams(location.search);
  const lang = (params.get('lang') || localStorage.getItem('hp_lang') || 'pl').toLowerCase();
  const setText  = (id, val) => { const el = document.getElementById(id); if (el && val) el.textContent = val; };
  const toggleBtn = document.getElementById('langToggle');

  const dTitle = document.getElementById('drawerTitle');
  const mPlan = document.getElementById('menuPlan');
  const mDetails = document.getElementById('menuDetails');
  const mAbout = document.getElementById('menuAbout');
  const mContact = document.getElementById('menuContact');

  if (lang === 'en') {
    setText('title','Plan generator');
    setText('subtitle','Choose answers and pay. After the payment the plan (Excel) will be sent to your e-mail.');
    setText('hA','Plan — questions (5)');
    setText('a1lbl','How many days per week would you like to train?');
    setText('a2lbl','What is your main goal?');
    setText('a3lbl','What is your training level?');
    setText('a4lbl','What equipment do you have access to?');
    setText('a5lbl','Gender');
    setText('genBtn','Generate plan');
    setText('dlBtn','Download Excel');
    setText('whoLbl','The plan will be sent to e-mail: ');
    setText('rodoLbl','This is not medical advice. Use at your own risk.');

    if (dTitle) dTitle.textContent = 'Menu';
    if (mPlan) mPlan.textContent = 'Training plan';
    if (mDetails) mDetails.textContent = 'Plan creation details';
    if (mAbout) mAbout.textContent = 'About me';
    if (mContact) mContact.textContent = 'Contact';

    localStorage.setItem('hp_lang','en');
    if (toggleBtn){ toggleBtn.href='?lang=pl'; toggleBtn.textContent='PL'; }
  } else {
    localStorage.setItem('hp_lang','pl');
    if (toggleBtn){ toggleBtn.href='?lang=en'; toggleBtn.textContent='EN'; }

    if (dTitle) dTitle.textContent = 'Menu';
    if (mPlan) mPlan.textContent = 'Plan treningowy';
    if (mDetails) mDetails.textContent = 'Szczegóły tworzenia planu treningowego';
    if (mAbout) mAbout.textContent = 'O mnie';
    if (mContact) mContact.textContent = 'Kontakt';
  }
})();
</script>
</body>
</html>
